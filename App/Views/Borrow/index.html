{% extends 'base.html' %}

{% block title %}Borrow{% endblock %}

{% block body %}

<style>
    .ui-front {
        z-index: 2000 !important;
    }
</style>

<div class="row mb-3">
    <div class="col-lg-1"></div>
    <div class="col-lg-10">
        <div class="card">
            <div class="card-header">
                <h4>Borrow Info</h4>
            </div>
            <div class="card-body">
                <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#addBorrowerForm">Add
                    Borrower</button>

                <h5 class="borrow">
                    Borrow
                </h5>
            </div>
        </div>
    </div>
    <div class="col-lg-1"></div>

</div>

<div class="row">
    <div class="col-lg-1"></div>
    <div class="col-lg-10">
        <div class="card">
            <div class="card-body borrow-info">

            </div>
        </div>
    </div>
    <div class="col-lg-1"></div>
</div>


<div class="modal fade" id="addBorrowerForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Add Borrower</h4>
            </div>
            <form action="/borrow/addBorrower" method="post">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="inputBorrowerName" class="col-form-label">Name :</label>
                        <input type="text" class="form-control id" id="inputBorrowerName" name="borrow_by" required />
                    </div>

                    <div class="form-group">
                        <label for="inputBorrowDate" class="col-form-label">Date Borrow :</label>
                        <input type="date" class="form-control " id="inputBorrowDate" name="borrow_date" required />
                    </div>

                    <div class="form-group">
                        <label for="inputPrincipalAmount" class="col-form-label">Principal Amount :</label>
                        <input type="text" class="form-control" id="inputPrincipalAmount" name="borrow_amount"
                            required />
                    </div>

                    <div class="form-group">
                        <label for="inputMonthstoPay" class="col-form-label">Months to Pay :</label>
                        <input type="text" class="form-control" id="inputMonthstoPay" name="months_to_pay" required />
                    </div>

                    <div class="form-group">
                        <label for="inputInterest" class="col-form-label">Interest :</label>
                        <input type="text" class="form-control" id="inputInterest" name="borrow_interest" required />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success m-auto">Save</button>
                </div>

            </form>

        </div>
    </div>
</div>

{% endblock %}


{% block javascript %}
<script>

    $(function () {
        //autocomplete
        $(".id").autocomplete({
            source: '/account/get-id',
            minLength: 1
        });
        $(".loan_date").datepicker({
            dateFormat: "yy-mm-dd"
        });
    });

    let group, i, o;
    let year = ["2019-10-15", "2019-10-31", "2019-11-15", "2019-11-30", "2019-12-15", "2019-12-31",
        "2020-01-15", "2020-01-31", "2020-02-15", "2020-02-28", "2020-03-15", "2020-03-31",
        "2020-04-15", "2020-04-30", "2020-05-15", "2020-05-31", "2020-06-15", "2020-06-30",
        "2020-07-15", "2020-07-31", "2020-08-15", "2020-08-31", "2020-09-15", "2020-09-30"];

    $('h5.borrow').click(function () {

        $('div.admin-info').empty();
        for (o = 0; o < year.length; o++) {

            borrowMonth(year[o]);


            $('div.borrow-info').append(
                '<div class="card mb-3">' +
                '<div class="card-header">' +
                '<h5>' + year[o] + '</h5>' +
                '</div>' +
                '<div class="card-body ' + year[o] + '">' +
                '</div>' +
                '</div>');

        }
    });

    function borrowMonth(month) {
        $.get("/Borrow/borrowMonth", { month: month }).done(function (data) {

            data = JSON.parse(data);
            //console.log(data1);

            if (data.length > 0) {
                $('div.' + month).append(
                    '<table class="table table-bordered member-info text-center">' +
                    '<thead> <tr>' +
                    '<th>Name</th>' +
                    '<th>Date</th>' +
                    '<th>Principal</th> ' +
                    '<th>Payment</th> ' +
                    '<th>Remaining</th> ' +
                    '<th>Interest Acquired</th> ' +
                    '</tr> </thead>' +
                    '<tbody class="' + month + '"></tbody>'
                );
                for (i = 0; i < data.length; i++) {
                    dataDetails = {
                        name: data[i]['name'],
                        date_borrow: data[i]['date_borrow'],
                        principal: data[i]['principal'],
                        payment: data[i]['payment'],
                        remaining: data[i]['remaining'],
                        int_acquired: data[i]['int_acquired']
                    };

                    $('tbody.' + month).append(
                        '<tr>' +
                        '<td>' + dataDetails.name + '</td>' +
                        '<td>' + dataDetails.date_borrow + '</td>' +
                        '<td class="principal">' + dataDetails.principal + '</td>' +
                        '<td class="payment">' + dataDetails.payment + '</td>' +
                        '<td class="remaining">' + dataDetails.remaining + '</td>' +
                        '<td class="int_acquired">' + dataDetails.int_acquired + '</td>' +
                        '<tr>'
                    );



                }

                $('tr.total_' + month).remove();
                $('tbody.' + month).append(
                    '<tr class="total_' + month + '">' +
                    '<td colspan="2">Total </td>' +
                    '<td class="total_principal"></td>' +
                    '<td class="total_payment"></td>' +
                    '<td class="total_remaining"></td>' +
                    '<td class="total_int_acquired"></td>' +
                    '<tr>'
                );

                console.log('tr.total_' + month);

                let tabs = ['principal', 'payment', 'remaining', 'int_acquired'];

                for (t = 0; t < tabs.length; t++) {
                    $('div.' + month + ' td.' + tabs[t]).each(function () {
                        tdname = $(this).attr("class");
                        //console.log(tdname);
                        let sum = 0;
                        $('.' + tdname).each(function () {
                            values = parseFloat($(this).text());
                            sum += isNaN(values) ? 0 : values;

                            $('.total_' + tdname).text(sum);

                        });
                    });

                }



            } else {
                $('div.' + month).append('<div class="text-center"> No Data </div>');
            }

        });

    }

</script>
{% endblock %}