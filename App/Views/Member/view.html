{% extends 'base.html' %}

{% block title %} {{ user_info.name }} {% endblock %}

{% block body %}

<div class="row">

    <div class="col-12 col-lg-6 col-xl-6 mb-5">

        <div class="card">

            <div class="card-body">
                <div class="form-inline">
                    <label for="">Name :</label>
                    <label for="" class="font-weight-bold ml-3">{{ user_info.name }}</label>
                </div>

                <div class="form-inline">
                    <label for="">Group :</label>
                    <label for="" class="font-weight-bold ml-3">{{ user_info.belonging_group }}</label>
                </div>
            </div>
        </div>

    </div>



</div>

<div class="row">

    <div class="col-12 col-lg-12 col-xl-12 mb-5">
        <div class="card">
            <div class="card-header d-flex">
                <h5>Contribution</h5>
                <button class="btn btn-success ml-auto" data-toggle="modal" data-target=".add-contribution">Add
                    Contribution</button>
            </div>
            <div class="table-responsive">
                <table class="table text-center table-flush">
                    <thead>
                        <tr>
                            <th>
                                Month
                            </th>
                            <th>
                                Contribution
                            </th>
                            <th>
                                Interest
                            </th>
                            <th>
                                Contribution + Interest
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contribution in contribution_list %}
                        <tr>
                            <td>
                                {{ contribution.contri_date}}
                            </td>
                            <td class="contri">
                                {{ contribution.contri}}
                            </td>
                            <td class="month_int">
                                {{ contribution.month_int}}
                            </td>
                            <td class="total_contri_w_int">
                                {{ contribution.total_contri_w_int}}
                            </td>
                        </tr>
                        {% endfor %}

                        <tr>
                            <td class="font-weight-bold">
                                Total
                            </td>
                            <td class="total-contri">

                            </td>
                            <td class="total-month_int">

                            </td>
                            <td class="total-total_contri_w_int">

                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>

    <div class="col-12 col-lg-12 col-xl-12 mb-5">
        <div class="card">
            <div class="card-header d-flex">
                <h5>Borrow</h5>
                {% if borrow_list %}

                <button class="btn btn-success ml-auto" data-toggle="modal" data-target="#addPayment">Pay Borrow</button>

                {% else %}
                <button class="btn btn-success ml-auto">Add
                    Borrow</button>

                {% endif %}
            </div>
            <div class="table-responsive">
                <table class="table text-center table-flush">
                    <thead>
                        <tr>
                            <th>
                                Borrow ID #
                            </th>

                            <th>
                                Date
                            </th>
                            <th>
                                Principal
                            </th>
                            <th>
                                Payment
                            </th>
                            <th>
                                Remaining
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for borrow in borrow_list %}
                        <tr>
                            <td>
                                <a href="/payment/view/{{ borrow.id}}">{{ borrow.id}}</a>
                                
                            </td>
                            <td>
                                {{ borrow.date_borrow}}
                            </td>
                            <td class="principal">
                                {{ borrow.principal}}
                            </td>
                            <td class="payment">
                                {{ borrow.payment}}
                            </td>
                            <td class="remaining">
                                {{ borrow.remaining}}
                            </td>
                        </tr>
                        {% endfor %}

                        <tr>
                            
                            <td class="font-weight-bold">
                                Total
                            </td>
                            <td>
                                
                            </td>
                            <td class="total-principal">

                            </td>
                            <td class="total-payment">

                            </td>
                            <td class="total-remaining">

                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>
    </div>


</div>



<div class="modal fade bd-example-modal-sm add-contribution" tabindex="-1" role="dialog"
    aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <form action="/contributions/add" method="post">
                <div class="modal-header">
                    <h5>Add Contri</h5>
                </div>
                <div class="modal-body">
                    <label class="col-form-label">I.D</label>
                    <input type="text" class="form-control id" name="user_id" value="{{ user_info.id }}" disabled>
                    <input type="hidden" class="form-control id" name="user_id" value="{{ user_info.id }}">

                    <label class="col-form-label">Name</label>
                    <input type="text" class="form-control name" name="name" value="{{ user_info.name }}" disabled>
                    <input type="hidden" class="form-control name" name="name" value="{{ user_info.name }}">

                    <label class="col-form-label">Group</label>
                    <input type="text" class="form-control group" name="belonging_group"
                        value="{{ user_info.belonging_group }}" disabled>
                    <input type="hidden" class="form-control group" name="belonging_group"
                        value="{{ user_info.belonging_group }}">

                    <label class="col-form-label">Choose Term</label>
                    <select name="term" class="form-control">
                        <option value=""> -- Choose a Term -- </option>
                        {% for term in terms %}
                        <option value="{{ term.term }}"> -- {{ term.term }} -- </option>

                        {% endfor %}
                    </select>

                    <label class="col-form-label">Choose Month</label>
                    <select name="month" class="form-control">
                        <option value=""> -- Choose a Month -- </option>
                    </select>



                    <label class="col-form-label">How much?</label>
                    <input type="text" class="form-control" name="contri">

                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>



{% endblock %}


{% block javascript %}

<script>

    let tabs = ['contri', 'month_int', 'total_contri_w_int'];

    for (t = 0; t < tabs.length; t++) {
        $(' td.' + tabs[t]).each(function () {
            tdname = $(this).attr("class");
            //console.log(tdname);
            let sum = 0;
            $('.' + tdname).each(function () {
                values = parseFloat($(this).text());
                sum += isNaN(values) ? 0 : values;

                $('.total-' + tdname).text(sum);

            });
        });

    }

    $('select[name=term]').on('change', function () {
        console.log($(this).val());

        let term = $(this).val();

        console.log(months(term));
    });

    function months(year) {
        $.get("/terms/months", { term: year }).done(function (data) {

            data = JSON.parse(data);
            monthList(data)
            //console.log(data);

            /*
            for (let index = 0; index < data.length; index++) {

                $('div.months').append(
                    '<button type="button" class="btn btn-primary col-6 col-lg-6 col-xl-3 mb-1 mnth" data-month="' + data[index]['month_start'] + '">  ' + data[index]['month_start'] + ' </button>'
                );

            }
            */


        });
    }

    function monthList(months) {

        $('select[name=month]').empty();
        $('select[name=month]').append('<option value=""> -- Choose a Month -- </option>')

        for (let index = 0; index < months.length; index++) {

            $('select[name=month]').append(
                '<option value="' + months[index]['month_start'] + '"> -- ' + months[index]['month_start'] + ' -- </option>'
            );

        }
    }

</script>

{% endblock %}